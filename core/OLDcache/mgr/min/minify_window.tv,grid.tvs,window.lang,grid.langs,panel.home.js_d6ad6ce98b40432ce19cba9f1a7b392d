Lingua.window.TV=function(config){config=config||{};Ext.applyIf(config,{url:Lingua.config.connectorUrl,fields:[{xtype:'lingua-combo-tv'}],width:330});Lingua.window.TV.superclass.constructor.call(this,config);};Ext.extend(Lingua.window.TV,MODx.Window);Ext.reg('lingua-window-tv',Lingua.window.TV);;Lingua.grid.TVs=function(config){config=config||{};Ext.applyIf(config,{id:'lingua-grid-tvs',url:Lingua.config.connectorUrl,baseParams:{action:'mgr/tv/getList'},fields:['id','name','type'],paging:true,remoteSort:true,anchor:'97%',autoExpandColumn:'name',columns:[{header:_('id'),dataIndex:'id',sortable:true,hidden:true,width:40},{header:_('name'),dataIndex:'name',sortable:true},{header:_('type'),dataIndex:'type',sortable:true}],tbar:[{text:_('lingua.add_tv'),handler:{xtype:'lingua-window-tv',title:_('lingua.add_tv'),baseParams:{action:'mgr/tv/create'},blankValues:true}},'->',{xtype:'textfield',emptyText:_('lingua.search...'),listeners:{'change':{fn:this.search,scope:this},'render':{fn:function(cmp){new Ext.KeyMap(cmp.getEl(),{key:Ext.EventObject.ENTER,fn:function(){this.fireEvent('change',this);this.blur();return true;},scope:cmp});},scope:this}}}]});Lingua.grid.TVs.superclass.constructor.call(this,config);};Ext.extend(Lingua.grid.TVs,MODx.grid.Grid,{search:function(tf,nv,ov){var s=this.getStore();s.baseParams.query=tf.getValue();this.getBottomToolbar().changePage(1);this.refresh();},getMenu:function(){return[{text:_('lingua.delete'),handler:this.removeTV}];},removeTV:function(){MODx.msg.confirm({title:_('lingua.delete'),text:_('lingua.delete_tv_confirm'),url:this.config.url,params:{action:'mgr/tv/remove',id:this.menu.record.id},listeners:{'success':{fn:this.refresh,scope:this}}});}});Ext.reg('lingua-grid-tvs',Lingua.grid.TVs);;Lingua.window.Lang=function(config){config=config||{};Ext.applyIf(config,{url:Lingua.config.connectorUrl,fields:[{html:_('lingua.ref')+' <a href="http://www.science.co.il/language/locale-codes.asp" target="_blank">http://www.science.co.il/language/locale-codes.asp</a>',border:false,bodyCssClass:'panel-desc'},{layout:'column',border:false,defaults:{border:false,autoHeight:true,layout:'form',columnWidth:.5,anchor:'95%'},items:[{items:[{xtype:'textfield',fieldLabel:_('lingua.local_name'),name:'local_name',anchor:'100%'},{xtype:'textfield',fieldLabel:_('lingua.lang_code'),name:'lang_code',anchor:'100%'},{xtype:'textfield',fieldLabel:_('lingua.lcid_string'),name:'lcid_string',anchor:'100%'},{xtype:'textfield',fieldLabel:_('lingua.lcid_dec'),name:'lcid_dec',anchor:'100%'}]},{items:[{xtype:'textfield',fieldLabel:_('lingua.date_format_lite'),name:'date_format_lite',anchor:'100%'},{xtype:'textfield',fieldLabel:_('lingua.date_format_full'),name:'date_format_full',anchor:'100%'},{xtype:'modx-combo-browser',fieldLabel:_('lingua.flag'),name:'flag',anchor:'100%',openTo:'assets/components/lingua/icons/flags/gif/',hideMode:'offsets',value:config.record&&config.record.flag?config.record.flag:'',renderer:function(value,metaData,record,rowIndex,colIndex,store){if(value){return'<div style="text-align:center;">'+'<img src="../'+value+'" style="max-width:40px; max-height:40px">'+'</div>';}}},{layout:'column',border:false,defaults:{border:false,autoHeight:true,layout:'form',columnWidth:.5,anchor:'95%'},items:[{items:[{xtype:'xcheckbox',fieldLabel:_('lingua.right_to_left'),name:'is_rtl',anchor:'50%'}]},{items:[{xtype:'xcheckbox',fieldLabel:_('lingua.active'),name:'active',anchor:'50%'}]}]}]}]}]});Lingua.window.Lang.superclass.constructor.call(this,config);};Ext.extend(Lingua.window.Lang,MODx.Window);Ext.reg('lingua-window-lang',Lingua.window.Lang);;Lingua.grid.Langs=function(config){config=config||{};Ext.applyIf(config,{id:'lingua-grid-langs',url:Lingua.config.connectorUrl,baseParams:{action:'mgr/langs/getList'},fields:['id','active','local_name','lang_code','lcid_string','lcid_dec','date_format_lite','date_format_full','is_rtl','flag'],paging:true,remoteSort:true,anchor:'97%',save_action:'mgr/langs/updateFromGrid',autosave:true,autoExpandColumn:'local_name',columns:[{header:_('id'),dataIndex:'id',sortable:true,hidden:true,width:40},{xtype:'checkcolumn',header:_('lingua.active'),tooltip:_('lingua.active'),dataIndex:'active',sortable:false,width:40,processEvent:this.processCheckColumn},{header:_('lingua.flag'),dataIndex:'flag',sortable:false,width:40,renderer:function(value,metaData,record,rowIndex,colIndex,store){if(value){return'<div style="text-align:center;">'+'<img src="../'+value+'" style="max-width:40px; max-height:40px">'+'</div>';}},editor:{xtype:'modx-combo-browser',browserEl:'modx-browser',id:'flag-browser',anchor:'100%',openTo:'assets/components/lingua/icons/flags/gif/',hideMode:'offsets',listeners:{'select':{fn:function(value){var selectedRow=this.getSelectionModel().getSelected();selectedRow.data.flag=value.url;MODx.Ajax.request({url:Lingua.config.connectorUrl,params:{action:'mgr/langs/updateFromGrid',data:JSON.stringify(selectedRow.data)}});this.refresh();},scope:this}}}},{header:_('lingua.local_name'),dataIndex:'local_name',sortable:true,editor:{xtype:'textfield'}},{header:_('lingua.lang_code'),dataIndex:'lang_code',sortable:true,width:60,editor:{xtype:'textfield'}},{header:_('lingua.lcid_string'),dataIndex:'lcid_string',sortable:true,editor:{xtype:'textfield'}},{header:_('lingua.lcid_dec'),dataIndex:'lcid_dec',sortable:true,width:70,editor:{xtype:'textfield'}},{header:_('lingua.date_format_lite'),dataIndex:'date_format_lite',sortable:false,width:60,editor:{xtype:'textfield'}},{header:_('lingua.date_format_full'),dataIndex:'date_format_full',sortable:false,editor:{xtype:'textfield'}},{xtype:'checkcolumn',header:_('lingua.rtl'),tooltip:_('lingua.right_to_left'),dataIndex:'is_rtl',width:40,sortable:false,processEvent:this.processCheckColumn}],tbar:[{text:_('lingua.lang_create'),handler:{xtype:'lingua-window-lang',title:_('lingua.lang_create'),baseParams:{action:'mgr/langs/create'},blankValues:true}},'->',{xtype:'textfield',id:'langs-search-filter',emptyText:_('lingua.search...'),listeners:{'change':{fn:this.search,scope:this},'render':{fn:function(cmp){new Ext.KeyMap(cmp.getEl(),{key:Ext.EventObject.ENTER,fn:function(){this.fireEvent('change',this);this.blur();return true;},scope:cmp});},scope:this}}}]});Lingua.grid.Langs.superclass.constructor.call(this,config);};Ext.extend(Lingua.grid.Langs,MODx.grid.Grid,{search:function(tf,nv,ov){var s=this.getStore();s.baseParams.query=tf.getValue();this.getBottomToolbar().changePage(1);this.refresh();},getMenu:function(){return[{text:_('lingua.update'),handler:this.updateLang},'-',{text:_('lingua.delete'),handler:this.removeLang}];},processCheckColumn:function(name,e,grid,rowIndex,colIndex){if(name==='mousedown'){var record=grid.store.getAt(rowIndex);record.set(this.dataIndex,!record.data[this.dataIndex]);MODx.Ajax.request({url:Lingua.config.connectorUrl,params:{action:'mgr/langs/updateFromGrid',data:JSON.stringify(record.data)},listeners:{'success':{fn:function(){Ext.getCmp('lingua-grid-langs').refresh();}}}});return false;}else{return Ext.grid.ActionColumn.superclass.processEvent.apply(this,arguments);}},updateLang:function(btn,e){if(!this.updateLangWindow){this.updateLangWindow=MODx.load({xtype:'lingua-window-lang',title:_('lingua.update'),baseParams:{action:'mgr/langs/update'},listeners:{'success':{fn:this.refresh,scope:this}}});}
this.updateLangWindow.baseParams['id']=this.menu.record.id;this.updateLangWindow.setValues(this.menu.record);this.updateLangWindow.show(e.target);},removeLang:function(){MODx.msg.confirm({title:_('lingua.delete'),text:_('lingua.delete_lang_confirm'),url:this.config.url,params:{action:'mgr/langs/remove',id:this.menu.record.id},listeners:{'success':{fn:this.refresh,scope:this}}});}});Ext.reg('lingua-grid-langs',Lingua.grid.Langs);;Lingua.panel.Home=function(config){config=config||{};Ext.applyIf(config,{border:false,baseCls:'modx-formpanel',cls:'container',items:[{html:'<b>'+_('lingua')+'</b> '+Lingua.config.version,border:false,cls:'modx-page-header'},{xtype:'modx-tabs',defaults:{border:false,autoHeight:true},border:true,items:[{title:_('lingua.settings'),defaults:{autoHeight:true},items:[{html:'<p>'+_('lingua.settings_desc')+'</p>',border:false,bodyCssClass:'panel-desc'},{xtype:'lingua-grid-langs',cls:'main-wrapper',preventRender:true}]},{title:_('lingua.scopes'),defaults:{autoHeight:true},items:[{html:'<p>'+_('lingua.scopes_desc')+'</p>',border:false,bodyCssClass:'panel-desc'},{xtype:'modx-tabs',defaults:{border:false,autoHeight:true},border:true,items:[{title:_('contexts'),items:[{html:'<p>'+_('lingua.context_scope_desc')+'</p>',border:false,bodyCssClass:'panel-desc'}]},{title:_('resources'),items:[{html:'<p>'+_('lingua.resource_scope_desc')+'</p>',border:false,bodyCssClass:'panel-desc'},{xtype:'lingua-grid-resourcescopes',cls:'main-wrapper',preventRender:true}]}]}]},{title:_('tmplvars'),defaults:{autoHeight:true},items:[{html:'<p>'+_('lingua.tmplvars_desc')+'</p>',border:false,bodyCssClass:'panel-desc'},{xtype:'modx-tabs',defaults:{border:false,autoHeight:true},border:true,items:[{title:_('lingua.list'),layout:'fit',defaults:{autoHeight:true},items:[{xtype:'lingua-grid-tvs',cls:'main-wrapper',preventRender:true}]},{title:_('lingua.cloningpatterns'),layout:'fit',defaults:{autoHeight:true},items:[{xtype:'panel',html:_('lingua.cloningpatterns_desc'),bodyCssClass:'panel-desc',anchor:'100%',border:false},{xtype:'lingua-grid-tvspatterns',cls:'main-wrapper',preventRender:true}]}]}]},{title:_('lingua.tools'),defaults:{autoHeight:true,border:true},padding:10,items:[{xtype:'panel',title:_('lingua.sync'),anchor:'100%',items:[{html:_('lingua.sync_desc'),bodyCssClass:'panel-desc'},{xtype:'lingua-grid-sync'}]}]}],listeners:{'afterrender':function(tabPanel){tabPanel.doLayout();}}},{html:'<a href="javascript:void(0);" style="color: #bbbbbb;" id="lingua_about">'+_('lingua.about')+'</a>',border:false,bodyStyle:'font-size: 10px; text-align: right; margin: 5px; background-color: transparent;',listeners:{afterrender:function(){Ext.get('lingua_about').on('click',function(){var msg='&copy; 2013-2015, ';msg+='<a href="http://www.virtudraft.com" target="_blank">';msg+='www.virtudraft.com';msg+='</a><br/>';msg+='License GPL v3';Ext.MessageBox.alert('Lingua',msg);});}}}]});Lingua.panel.Home.superclass.constructor.call(this,config);};Ext.extend(Lingua.panel.Home,MODx.Panel);Ext.reg('lingua-panel-home',Lingua.panel.Home);